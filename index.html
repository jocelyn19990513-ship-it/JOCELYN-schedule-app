<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æˆ‘çš„æ—¥ç¨‹æ¸…å• Â· Project 50</title>

  <!-- PWA ç›¸å…³ï¼šä¿æŒä½ åŸæ¥çš„å›¾æ ‡ -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="app-icon-v2.png" />

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 6px 0; /* å‡å°‘æ•´ä½“ä¸Šä¸‹ç•™ç™½ */
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Helvetica Neue", Arial, "Noto Sans SC", sans-serif;
      background: #f5f5f7;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      color: #111827;
    }

    .app {
      width: 95%;
      max-width: 540px;
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 18px 35px rgba(15, 23, 42, 0.12);
      padding: 14px 16px 18px;
    }

    .app-header {
      padding: 4px 2px 6px;
      border-bottom: 1px solid #e5e7eb;
      margin-bottom: 8px;
    }

    .app-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .app-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 20px;
      margin: 0;
    }

    .badge-logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      color: #fff;
      background: linear-gradient(135deg, #f472b6, #a855f7);
    }

    .app-subtitle {
      margin-top: 3px;
      font-size: 11px;
      color: #6b7280;
    }

    .app-meta {
      text-align: right;
      font-size: 10px;
      color: #9ca3af;
      margin-top: 2px;
    }

    /* é¡¶éƒ¨ Tabï¼šåªä¿ç•™å›¾æ ‡ï¼Œä¸è¦åœ†åœˆèƒŒæ™¯ */
    .tab-header {
      margin-top: 10px;
      margin-bottom: 6px;
      padding: 0;
      background: transparent;
      display: flex;
      gap: 10px;
      border-bottom: 1px solid #e5e7eb;
    }

    .tab-btn {
      flex: 1;
      border: none;
      background: transparent;
      padding: 4px 0 6px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      position: relative;
    }

    .tab-icon-wrap {
      width: auto;
      height: auto;
      background: transparent;
      border-radius: 0;
      box-shadow: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tab-icon-wrap img {
      width: 22px;
      height: 22px;
      border-radius: 0;
      display: block;
      opacity: 0.6;
    }

    /* å½“å‰æ¿€æ´»çš„ tabï¼šå›¾æ ‡æ›´äº®ï¼Œå¹¶åœ¨åº•éƒ¨åŠ ä¸€æ¡å°ç²‰çº¿ */
    .tab-btn.active .tab-icon-wrap img {
      opacity: 1;
    }

    .tab-btn.active::after {
      content: "";
      position: absolute;
      left: 20%;
      right: 20%;
      bottom: 0;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, #f472b6, #a855f7);
    }

    .tab-section { display: none; }
    .tab-section.active { display: block; }

    h2.section-title {
      font-size: 16px;
      margin: 0 0 4px;
    }

    .section-desc {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 8px;
    }

    /* é€šç”¨è¾“å…¥æ ·å¼ */
    input[type="text"],
    input[type="number"],
    input[type="date"],
    textarea,
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      font-size: 14px;
      outline: none;
      background: #f9fafb;
    }
    input:focus,
    textarea:focus,
    select:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.18);
      background: #ffffff;
    }

    button { font-family: inherit; }

    .primary-btn {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      background: linear-gradient(135deg, #6366f1, #ec4899);
      color: #ffffff;
      white-space: nowrap;
    }
    .primary-btn:active { transform: scale(0.97); }

    .small-btn {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      border: none;
      cursor: pointer;
      white-space: nowrap;
    }

    .badge-soft {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 10px;
      background: #f3f4f6;
      color: #4b5563;
    }

    .row-between {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .hint {
      font-size: 11px;
      color: #9ca3af;
    }

    .card {
      border-radius: 14px;
      padding: 8px 10px 10px;
      background: #f9fafb;
      box-shadow: inset 0 0 0 1px #e5e7eb;
      margin-bottom: 6px;
    }

    @media (max-width: 400px) {
      .tab-header { gap: 6px; }
    }

    /* Project 50 */
    .p50-date-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }
    .p50-date-row input[type="date"] { flex: 1; }

    .p50-rules {
      border-radius: 12px;
      background: #ffffff;
      padding: 6px 8px;
      max-height: 220px;
      overflow-y: auto;
      box-shadow: 0 1px 3px rgba(148, 163, 184, 0.25);
    }

    .p50-rule-item {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      padding: 5px 0;
      border-bottom: 1px solid #f3f4f6;
      font-size: 13px;
    }
    .p50-rule-item:last-child { border-bottom: none; }

    .p50-summary {
      font-size: 13px;
      color: #4b5563;
      margin-top: 6px;
    }

    .p50-note textarea {
      min-height: 70px;
      resize: vertical;
      font-size: 13px;
    }

    /* é€šç”¨æ—¥å† */
    .calendar-wrapper {
      margin-top: 8px;
      border-radius: 14px;
      background: #f9fafb;
      padding: 8px;
      box-shadow: inset 0 0 0 1px #e5e7eb;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .calendar-title {
      font-size: 13px;
      color: #4b5563;
    }
    .cal-nav {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .cal-nav-btn {
      border: none;
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 12px;
      cursor: pointer;
      background: #e5e7eb;
      color: #374151;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      font-size: 11px;
    }
    .cal-cell {
      min-height: 32px;
      border-radius: 7px;
      padding: 2px 3px;
      text-align: center;
      background: #e5e7eb;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .cal-weekday {
      font-weight: 600;
      background: transparent;
      color: #6b7280;
    }
    .cal-empty { background: transparent; }

    .cal-day-num { font-size: 11px; }

    .cal-minutes {
      font-size: 10px;
      color: #374151;
    }

    /* ç´«è‰²å¼ºåº¦ç­‰çº§ï¼ˆProject 50 å®Œæˆåº¦ / ä¸“æ³¨ç­‰çº§ï¼‰ */
    .cal-level-0 { background: #e5e7eb; color: #4b5563; }
    .cal-level-1 { background: #f5f3ff; color: #5b21b6; }
    .cal-level-2 { background: #e0e7ff; color: #4338ca; }
    .cal-level-3 { background: #c7d2fe; color: #3730a3; }
    .cal-level-4 { background: #a855f7; color: #f9fafb; }
  </style>
</head>
<body>
<div class="app">
  <header class="app-header">
    <div class="app-title-row">
      <h1 class="app-title">
        <span class="badge-logo">50</span>
        <span>æˆ‘çš„æ—¥ç¨‹æ¸…å•</span>
      </h1>
      <div class="badge-soft">v1.0.2</div>
    </div>
    <div class="app-subtitle">
      Project 50 æ‰“å¡ Â· To-Do ä¸“æ³¨ Â· é‡è¦äº‹é¡¹ Â· ä½“é‡ & è¿åŠ¨ï¼ˆæ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°ï¼‰
    </div>
    <div class="app-meta">designed by Jiayu Hou</div>
  </header>

  <!-- é¡¶éƒ¨ Tabï¼šåªæ˜¾ç¤º PNG å›¾æ ‡ -->
  <div class="tab-header">
    <button class="tab-btn active" data-target="tab-project50" title="Project 50">
      <span class="tab-icon-wrap">
        <img src="icon-project50.png" alt="Project 50" />
      </span>
    </button>
    <button class="tab-btn" data-target="tab-todo" title="å¾…åŠäº‹é¡¹">
      <span class="tab-icon-wrap">
        <img src="icon-todo.png" alt="To-Do" />
      </span>
    </button>
    <button class="tab-btn" data-target="tab-important" title="æ¯æ—¥é‡è¦äº‹é¡¹">
      <span class="tab-icon-wrap">
        <img src="icon-important.png" alt="Important" />
      </span>
    </button>
    <button class="tab-btn" data-target="tab-weight" title="ä½“é‡ & è¿åŠ¨">
      <span class="tab-icon-wrap">
        <img src="icon-weight.png" alt="Weight" />
      </span>
    </button>
    <button class="tab-btn" data-target="tab-about" title="ä½¿ç”¨è¯´æ˜">
      <span class="tab-icon-wrap">
        <img src="icon-about.png" alt="About" />
      </span>
    </button>
  </div>

  <!-- -------------------- Project 50 MODULE -------------------- -->
<section id="tab-project50" class="tab-section active">

  <!-- æ¯æ—¥ Challenge -->
  <div class="card">
    <h2 class="section-title">æ¯æ—¥ Challenge</h2>
    <div class="section-desc">
      æ ¹æ® Project 50ï¼ˆeasy æ¨¡å¼ï¼‰æ‰“å¡ï¼Œ7 æ¡å›ºå®šè§„åˆ™ï¼Œæ¯å¤©å¤ç›˜æ‰§è¡Œæƒ…å†µã€‚
    </div>

    <div class="p50-date-row">
      <input type="date" id="p50-date" />
      <button class="small-btn primary-btn" id="p50-today-btn">è·³åˆ°ä»Šå¤©</button>
    </div>

    <div class="p50-rules" id="p50-rules"></div>
    <div class="p50-summary" id="p50-summary"></div>
  </div>

  <!-- Notes -->
  <div class="card p50-note">
    <div class="row-between">
      <span class="hint">è®°å½•ä»Šå¤©çš„æŒ‘æˆ˜è¡Œç¨‹ / æ„Ÿå— / å¤ç›˜ï¼š</span>
      <span class="badge-soft">ä»…æœ¬åœ°å¯è§</span>
    </div>
    <textarea id="p50-note-input"
      placeholder="ä¾‹å¦‚ï¼š7:30 èµ·åºŠï¼Œé”»ç‚¼ 30 åˆ†é’Ÿï¼Œé˜…è¯» 6 é¡µâ€¦â€¦"></textarea>
  </div>

  <!-- Project 50 æ—¥å† -->
  <div class="calendar-wrapper">
    <div class="calendar-header">
      <div class="calendar-title" id="p50-calendar-title">Project 50 å®Œæˆæƒ…å†µ</div>
      <div class="cal-nav">
        <button class="cal-nav-btn" id="p50-cal-prev">â€¹</button>
        <button class="cal-nav-btn" id="p50-cal-next">â€º</button>
      </div>
    </div>
    <div class="hint">æ·±æµ…è¡¨ç¤ºå½“å¤©å®Œæˆè§„åˆ™æ•°é‡ï¼ˆè¶Šæ·±å®Œæˆè¶Šå¤šï¼‰ã€‚</div>
    <div class="calendar-grid" id="p50-calendar-grid"></div>
  </div>

</section>

<script>
/* è·å–ä»Šæ—¥ YYYY-MM-DD */
function getTodayStr() {
  const d = new Date();
  const m = String(d.getMonth() + 1).padStart(2, "0");
  const day = String(d.getDate()).padStart(2, "0");
  return d.getFullYear() + "-" + m + "-" + day;
}

/* æœˆä»½å¹³ç§»å·¥å…· */
function shiftMonth(date, delta) {
  return new Date(date.getFullYear(), date.getMonth() + delta, 1);
}

/* ---------------- Project 50 æ•°æ®ç»“æ„ ---------------- */
const P50_RULES = [
  { id: "wake", text: "æ—©ä¸Š 8 ç‚¹å‰èµ·åºŠ" },
  { id: "read", text: "æ¯å¤©é˜…è¯»ä¹¦ç±è‡³å°‘ 5 é¡µ" },
  { id: "exercise", text: "æ¯å¤©é”»ç‚¼è‡³å°‘ 30 åˆ†é’Ÿ" },
  { id: "nosoda", text: "ä¸å–ç¢³é…¸é¥®æ–™" },
  { id: "morning_routine", text: "å®Œæˆæ™¨èµ·è¡Œç¨‹ï¼ˆä¸ç©æ‰‹æœºï¼Œå¯å¬éŸ³ä¹ï¼‰" },
  { id: "plan_day", text: "è®°å½•ä»Šå¤©çš„è®¡åˆ’" },
  { id: "reflect", text: "ç®€å•å¤ç›˜ï¼šä»Šå¤©æ˜¯å¦æ¯”æ˜¨å¤©æ›´å¥½ï¼Ÿ" }
];

const P50_STORAGE_KEY = "project50_data_v1";
let p50Data = {};  // { dateStr: { rules:{id:bool}, note:string } }

const p50DateInput = document.getElementById("p50-date");
const p50TodayBtn = document.getElementById("p50-today-btn");
const p50RulesEl = document.getElementById("p50-rules");
const p50SummaryEl = document.getElementById("p50-summary");
const p50NoteInput = document.getElementById("p50-note-input");

const p50CalendarTitleEl = document.getElementById("p50-calendar-title");
const p50CalendarGridEl = document.getElementById("p50-calendar-grid");
const p50CalPrevBtn = document.getElementById("p50-cal-prev");
const p50CalNextBtn = document.getElementById("p50-cal-next");

let p50CalMonth;

/* è½½å…¥æœ¬åœ°å­˜å‚¨ */
function loadP50Data() {
  const raw = localStorage.getItem(P50_STORAGE_KEY);
  if (raw) {
    try { p50Data = JSON.parse(raw) || {}; }
    catch { p50Data = {}; }
  }
}

/* ä¿å­˜ */
function saveP50Data() {
  localStorage.setItem(P50_STORAGE_KEY, JSON.stringify(p50Data));
}

/* è·å–æŸå¤©ç»“æ„ */
function getP50DayData(dateStr) {
  if (!p50Data[dateStr]) {
    p50Data[dateStr] = { rules: {}, note: "" };
  }
  return p50Data[dateStr];
}

/* ---------------- é¡¹ç›®æ¸²æŸ“ ---------------- */
function renderP50Day() {
  const dateStr = p50DateInput.value || getTodayStr();
  p50DateInput.value = dateStr;

  const dayData = getP50DayData(dateStr);
  const rulesState = dayData.rules || {};

  p50RulesEl.innerHTML = "";
  let doneCount = 0;

  P50_RULES.forEach(rule => {
    const item = document.createElement("div");
    item.className = "p50-rule-item";

    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.checked = !!rulesState[rule.id];

    cb.addEventListener("change", () => {
      const d = getP50DayData(p50DateInput.value);
      d.rules[rule.id] = cb.checked;
      saveP50Data();
      renderP50Calendar();
    });

    if (cb.checked) doneCount++;

    const label = document.createElement("div");
    label.textContent = rule.text;

    item.appendChild(cb);
    item.appendChild(label);
    p50RulesEl.appendChild(item);
  });

  p50SummaryEl.textContent =
    `ä»Šæ—¥å®Œæˆæƒ…å†µï¼š ${doneCount} / ${P50_RULES.length} æ¡å·²å®Œæˆ`;

  p50NoteInput.value = dayData.note || "";
}

/* æ—¥å†æ¸²æŸ“ */
function renderP50Calendar() {
  const base = p50CalMonth || new Date();
  const year = base.getFullYear();
  const month = base.getMonth(); // 0â€“11

  p50CalendarTitleEl.textContent = `Project 50 æ—¥å† Â· ${year} å¹´ ${month + 1} æœˆ`;

  const countByDay = {};
  Object.keys(p50Data).forEach(dateStr => {
    const d = new Date(dateStr);
    if (d.getFullYear() === year && d.getMonth() === month) {
      const day = d.getDate();
      const rules = p50Data[dateStr].rules || {};
      let count = 0;
      P50_RULES.forEach(r => { if (rules[r.id]) count++; });
      countByDay[day] = count;
    }
  });

  const firstDay = new Date(year, month, 1);
  const firstWeekday = firstDay.getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  p50CalendarGridEl.innerHTML = "";

  /* æ˜ŸæœŸè¡Œ */
  ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"].forEach(w => {
    const cell = document.createElement("div");
    cell.className = "cal-cell cal-weekday";
    cell.textContent = w;
    p50CalendarGridEl.appendChild(cell);
  });

  /* ç©ºç™½æ ¼ */
  for (let i = 0; i < firstWeekday; i++) {
    const empty = document.createElement("div");
    empty.className = "cal-cell cal-empty";
    p50CalendarGridEl.appendChild(empty);
  }

  /* æ—¥æœŸæ ¼ */
  for (let day = 1; day <= daysInMonth; day++) {
    const cell = document.createElement("div");
    const count = countByDay[day] || 0;

    let level = "cal-level-0";
    if (count >= 7) level = "cal-level-4";
    else if (count >= 5) level = "cal-level-3";
    else if (count >= 3) level = "cal-level-2";
    else if (count >= 1) level = "cal-level-1";

    cell.className = "cal-cell " + level;

    const num = document.createElement("div");
    num.className = "cal-day-num";
    num.textContent = day;

    cell.appendChild(num);
    p50CalendarGridEl.appendChild(cell);
  }
}

/* ç¬”è®°å®æ—¶ä¿å­˜ */
p50NoteInput.addEventListener("input", () => {
  const dateStr = p50DateInput.value || getTodayStr();
  const d = getP50DayData(dateStr);
  d.note = p50NoteInput.value;
  saveP50Data();
});

/* ç‚¹å‡»åˆ‡æ¢æ—¥æœŸ */
p50DateInput.addEventListener("change", renderP50Day);

/* è·³åˆ°ä»Šå¤© */
p50TodayBtn.addEventListener("click", () => {
  p50DateInput.value = getTodayStr();
  p50CalMonth = new Date();
  p50CalMonth.setDate(1);
  renderP50Day();
  renderP50Calendar();
});

/* æœˆä»½åˆ‡æ¢æŒ‰é’® */
p50CalPrevBtn.addEventListener("click", () => {
  p50CalMonth = shiftMonth(p50CalMonth, -1);
  renderP50Calendar();
});
p50CalNextBtn.addEventListener("click", () => {
  p50CalMonth = shiftMonth(p50CalMonth, 1);
  renderP50Calendar();
});
</script>

<!-- åœ¨ body é‡Œè¡¥å……æ›´å¤šæ ·å¼ï¼ˆåˆæ³•å¯ç”¨ï¼‰ -->
<style>
  /* To-Do æ ç›® */
  .todo-top-row {
    display: flex;
    gap: 8px;
    margin-bottom: 6px;
  }
  .todo-top-row input[type="text"] { flex: 2; }
  .todo-top-row select { flex: 1.2; }

  .todo-second-row {
    display: flex;
    gap: 8px;
    margin-bottom: 4px;
  }
  .todo-second-row input[type="date"] { flex: 1; }

  .todo-list {
    list-style: none;
    padding: 0;
    margin: 6px 0 0;
    max-height: 230px;
    overflow-y: auto;
  }
  .todo-empty {
    font-size: 13px;
    color: #9ca3af;
    text-align: center;
    margin-top: 6px;
  }

  .todo-item {
    padding: 6px 2px 4px;
    border-bottom: 1px solid #e5e7eb;
  }

  .todo-main-row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 6px;
  }

  .todo-main {
    flex: 1;
    min-width: 0;
  }

  .todo-title {
    font-size: 14px;
    word-break: break-word;
  }
  .todo-title.done {
    text-decoration: line-through;
    color: #9ca3af;
  }

  .badge-category {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 11px;
    background: #fee2f2;
    color: #db2777;
    margin-right: 4px;
  }
  .todo-meta-text {
    font-size: 11px;
    color: #6b7280;
  }

  .done-row {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 11px;
    color: #4b5563;
    white-space: nowrap;
  }

  .todo-actions-row {
    margin-top: 4px;
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }

  .focus-btn { background: #6366f1; color: #fff; }
  .focus-btn.stop { background: #ec4899; }
  .delete-btn { background: #ef4444; color: #fff; }
  .edit-btn { background: #f97316; color: #fff; }

  /* é‡è¦äº‹é¡¹ */
  .important-list {
    margin-top: 6px;
    max-height: 220px;
    overflow-y: auto;
    padding-left: 0;
    list-style: none;
  }
  .important-item {
    font-size: 13px;
    padding: 4px 2px;
    border-bottom: 1px solid #e5e7eb;
  }
  .important-top-row {
    display: flex;
    justify-content: space-between;
    gap: 6px;
    align-items: center;
  }
  .important-title { font-weight: 500; }

  .important-type-badge {
    display: inline-block;
    padding: 1px 6px;
    border-radius: 999px;
    font-size: 10px;
    margin-right: 4px;
    margin-bottom: 2px;
    color: #fff;
  }

  /* ä¸ƒç§é‡è¦äº‹é¡¹ç±»å‹çš„é¢œè‰² */
  .imp-type-ç”Ÿæ´»é‡è¦äº‹é¡¹ { background: #f97373; }
  .imp-type-å§¨å¦ˆæœŸ { background: #ec4899; }
  .imp-type-å›ºå®šèµ„é‡‘äº¤ä»˜æ—¥ { background: #8b5cf6; }
  .imp-type-ç”Ÿæ—¥ { background: #facc15; color: #78350f; }
  .imp-type-çºªå¿µæ—¥ { background: #14b8a6; }
  .imp-type-å·¥ä½œé‡è¦äº‹é¡¹ { background: #3b82f6; }
  .imp-type-å­¦ä¸šé‡è¦äº‹é¡¹ { background: #a855f7; }

    /* æ—¥å†é‡Œçš„å°è‰²å—ï¼ˆå¸¦æ–‡å­—çš„ mini chipï¼‰ */
  .important-chip {
    display: block;
    font-size: 10px;
    border-radius: 999px;
    padding: 1px 4px;
    margin-top: 2px;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: #fff; /* ç”Ÿæ—¥ä¼šè¢« imp-type-ç”Ÿæ—¥ è¦†ç›–æˆæ·±è‰² */
  }

  .important-note {
    font-size: 12px;
    color: #6b7280;
    margin-top: 2px;
  }
  .important-date {
    font-size: 11px;
    color: #9ca3af;
    margin-top: 1px;
  }

  /* ä½“é‡ & è¿åŠ¨ */
  .weight-row {
    display: flex;
    gap: 8px;
    margin-bottom: 6px;
  }
  .weight-row input[type="number"] { flex: 1; }
  .weight-row input[type="text"] { flex: 2; }

  .weight-list {
    list-style: none;
    padding: 0;
    margin: 6px 0 0;
    max-height: 160px;
    overflow-y: auto;
    font-size: 13px;
  }
  .weight-item {
    padding: 4px 2px;
    border-bottom: 1px solid #e5e7eb;
  }
  .weight-meta {
    font-size: 11px;
    color: #6b7280;
    margin-top: 1px;
  }

  canvas {
    max-width: 100%;
    border-radius: 10px;
    background: #f3f4f6;
  }

  /* ä½¿ç”¨è¯´æ˜ */
  .about-list {
    font-size: 13px;
    color: #4b5563;
    padding-left: 1.2em;
  }
    /* é‡è¦äº‹é¡¹ï¼šæ—¥å†é‡Œçš„æ–‡å­—æ˜¾ç¤º */
  .important-event-text {
    font-size: 10px;
    color: #4b5563;
    margin-top: 2px;
    line-height: 1.2;
    max-height: 24px;      /* è¶…å‡ºä¸¤è¡Œå°±éšè— */
    overflow: hidden;
  }
    .about-hero {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 8px;
  }
  .about-hero-icon {
    width: 28px;
    height: 28px;
    border-radius: 999px;
    background: linear-gradient(135deg, #f9a8d4, #a855f7);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 16px;
  }
  .about-hero-text-title {
    font-size: 14px;
    font-weight: 600;
    color: #4b5563;
  }
  .about-hero-text-sub {
    font-size: 12px;
    color: #9ca3af;
  }
  .about-section-title {
    font-size: 13px;
    font-weight: 600;
    margin: 6px 0 4px;
    color: #4b5563;
    display: flex;
    align-items: center;
    gap: 4px;
  }


  /* é¥¼å›¾å›¾ä¾‹ */
  .pie-legend {
    margin-top: 6px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px 10px;
    font-size: 11px;
    color: #4b5563;
  }
  .pie-legend-item {
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .pie-legend-color {
    width: 10px;
    height: 10px;
    border-radius: 3px;
    background: #9ca3af;
  }
</style>

<!-- -------------------- To-Do æ¨¡å— -------------------- -->
<section id="tab-todo" class="tab-section">
  <div class="card">
    <h2 class="section-title">å¾…åŠäº‹é¡¹ & ä¸“æ³¨è®°å½•</h2>
    <div class="section-desc">
      æ¯å¤©åˆ›å»ºå¾…åŠï¼ŒæŒ‰ç±»åˆ«ç®¡ç†ã€‚ç‚¹å‡»â€œå¼€å§‹ä¸“æ³¨ / ç»“æŸä¸“æ³¨â€è®°å½•çœŸå®ä¸“æ³¨æ—¶é—´ï¼Œå¯éšæ—¶ç¼–è¾‘å†…å®¹ã€‚
    </div>

    <div class="todo-top-row">
      <input type="text" id="todo-title"
             placeholder="è¦åšä»€ä¹ˆï¼Ÿä¾‹å¦‚ï¼šé˜…è¯»ã€ŠXXXã€‹5 é¡µ" />
      <select id="todo-category">
        <option value="å­¦ä¹ ">å­¦ä¹ </option>
        <option value="å·¥ä½œ">å·¥ä½œ</option>
        <option value="å®¶åº­">å®¶åº­</option>
        <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
        <option value="å¨±ä¹">å¨±ä¹</option>
        <option value="å…¶ä»–">å…¶ä»–</option>
      </select>
    </div>

    <div class="todo-second-row">
      <input type="date" id="todo-date" />
      <button class="primary-btn" id="todo-add-btn">æ·»åŠ å¾…åŠ</button>
    </div>
    <div class="hint">
      å¾…åŠå¯ä»¥ã€Œç¼–è¾‘ã€æ ‡é¢˜å’Œåˆ†ç±»ï¼Œä¹‹å‰ç´¯è®¡çš„ä¸“æ³¨æ—¶é—´ä¸ä¼šä¸¢å¤±ã€‚
    </div>

    <ul class="todo-list" id="todo-list"></ul>
    <div class="todo-empty" id="todo-empty">è¿™å¤©è¿˜æ²¡æœ‰å¾…åŠï¼Œå¯ä»¥å…ˆæ·»åŠ ä¸€æ¡ï½</div>
  </div>

  <!-- æŒ‰ç±»åˆ«çš„æ—¥å†ï¼ˆç”¨è‰²æ¡æ˜¾ç¤ºå½“å¤©æœ‰å“ªäº›ç±»åˆ«ï¼‰ -->
  <div class="calendar-wrapper">
    <div class="calendar-header">
      <div class="calendar-title" id="focus-calendar-title">ä¸“æ³¨ç±»åˆ«æ—¥å†</div>
      <div class="cal-nav">
        <button class="cal-nav-btn" id="focus-cal-prev">â€¹</button>
        <button class="cal-nav-btn" id="focus-cal-next">â€º</button>
      </div>
    </div>
    <div class="hint">
      æ¯å¤©çš„è‰²æ¡è¡¨ç¤ºå½“æ—¥å®Œæˆä»»åŠ¡çš„ç±»åˆ«ï¼›ç‚¹å‡»æŸä¸€å¤©ï¼Œä¼šåœ¨ä¸Šæ–¹åˆ—è¡¨æ˜¾ç¤ºå½“å¤©ä»»åŠ¡ã€‚
    </div>
    <div class="calendar-grid" id="focus-calendar-grid"></div>
  </div>

  <!-- ä¸“æ³¨æ—¶é—´ç»Ÿè®¡é¥¼å›¾ -->
  <div class="card">
    <h2 class="section-title">ä¸“æ³¨æ—¶é—´ç»Ÿè®¡</h2>
    <div class="section-desc">
      ç»Ÿè®¡ä¸åŒç±»åˆ«åœ¨æœ€è¿‘ä¸€å‘¨ / æœ¬æœˆ / æœ¬å¹´çš„ä¸“æ³¨æ—¶é—´å æ¯”ï¼ˆä»…ç»Ÿè®¡æœ‰ä¸“æ³¨è®°å½•çš„ä»»åŠ¡ï¼‰ã€‚
    </div>
    <div class="row-between" style="margin-bottom:6px;">
      <div>
        <button class="small-btn primary-btn" id="pie-week-btn">æœ€è¿‘ä¸€å‘¨</button>
        <button class="small-btn" id="pie-month-btn">æœ¬æœˆ</button>
        <button class="small-btn" id="pie-year-btn">æœ¬å¹´</button>
      </div>
      <span class="hint" id="pie-label">æœ€è¿‘ä¸€å‘¨</span>
    </div>
    <canvas id="focus-pie" height="180"></canvas>
    <div class="pie-legend" id="pie-legend"></div>
  </div>
</section>

<!-- -------------------- æ¯æ—¥é‡è¦äº‹é¡¹ -------------------- -->
<section id="tab-important" class="tab-section">
  <div class="card">
    <h2 class="section-title">æ¯æ—¥é‡è¦äº‹é¡¹</h2>
    <div class="section-desc">
      è®°å½•ã€Œç”Ÿæ´»é‡è¦äº‹é¡¹ / å§¨å¦ˆæœŸ / å›ºå®šèµ„é‡‘äº¤ä»˜æ—¥ / ç”Ÿæ—¥ / çºªå¿µæ—¥ / å·¥ä½œé‡è¦äº‹é¡¹ / å­¦ä¸šé‡è¦äº‹é¡¹ã€ï¼Œ
      åœ¨æ—¥å†ä¸­ä¸€çœ¼çœ‹åˆ°é‡è¦æ—¥å­ã€‚
    </div>

    <div class="todo-second-row">
      <input type="date" id="important-date" />
      <select id="important-type">
        <option value="ç”Ÿæ´»é‡è¦äº‹é¡¹">ç”Ÿæ´»é‡è¦äº‹é¡¹</option>
        <option value="å§¨å¦ˆæœŸ">å§¨å¦ˆæœŸ</option>
        <option value="å›ºå®šèµ„é‡‘äº¤ä»˜æ—¥">å›ºå®šèµ„é‡‘äº¤ä»˜æ—¥</option>
        <option value="ç”Ÿæ—¥">ç”Ÿæ—¥</option>
        <option value="çºªå¿µæ—¥">çºªå¿µæ—¥</option>
        <option value="å·¥ä½œé‡è¦äº‹é¡¹">å·¥ä½œé‡è¦äº‹é¡¹</option>
        <option value="å­¦ä¸šé‡è¦äº‹é¡¹">å­¦ä¸šé‡è¦äº‹é¡¹</option>
      </select>
    </div>
    <input type="text" id="important-title"
           placeholder="äº‹ä»¶æ ‡é¢˜ï¼Œå¦‚ï¼šæˆ¿ç§Ÿã€æŸäººç”Ÿæ—¥ã€è€ƒè¯•å‘¨å¼€å§‹â€¦" />
    <textarea id="important-note"
      style="margin-top:6px;" placeholder="å¯é€‰å¤‡æ³¨ï¼šåœ°ç‚¹ã€æ—¶é—´ã€å‡†å¤‡äº‹é¡¹ç­‰"></textarea>
    <div class="row-between" style="margin-top:6px;">
      <button class="primary-btn small-btn" id="important-add-btn">æ·»åŠ é‡è¦äº‹é¡¹</button>
      <span class="hint">æç¤ºï¼šç”Ÿæ—¥ / çºªå¿µæ—¥ç­‰å»ºè®®æ¯å¹´è‡ªå·±æŸ¥çœ‹æ—¥å†ã€‚</span>
    </div>

    <ul class="important-list" id="important-list"></ul>
  </div>

  <div class="calendar-wrapper">
    <div class="calendar-header">
      <div class="calendar-title" id="important-calendar-title">é‡è¦äº‹é¡¹æ—¥å†</div>
      <div class="cal-nav">
        <button class="cal-nav-btn" id="important-cal-prev">â€¹</button>
        <button class="cal-nav-btn" id="important-cal-next">â€º</button>
      </div>
    </div>
    <div class="hint">
      ä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒç±»å‹çš„é‡è¦äº‹é¡¹ï¼›ç‚¹å‡»æŸä¸€å¤©ï¼Œå¯ä»¥åœ¨ä¸Šæ–¹åˆ—è¡¨çœ‹åˆ°è¿™å¤©çš„è¯¦æƒ…ã€‚
    </div>
    <div class="calendar-grid" id="important-calendar-grid"></div>
  </div>
</section>

<!-- -------------------- ä½“é‡ & è¿åŠ¨ -------------------- -->
<section id="tab-weight" class="tab-section">
  <div class="card">
    <h2 class="section-title">ä½“é‡ & è¿åŠ¨è®°å½•</h2>
    <div class="section-desc">
      è®°å½•æ¯å¤©ä½“é‡ä»¥åŠé”»ç‚¼å†…å®¹ï¼ˆå¦‚ï¼šæ…¢è·‘ 30 åˆ†é’Ÿã€è‚©é¢ˆæ‹‰ä¼¸ 15 åˆ†é’Ÿï¼‰ï¼Œ
      ç”¨æŠ˜çº¿å›¾æŸ¥çœ‹å½“æœˆä½“é‡å˜åŒ–ã€‚
    </div>

    <div class="todo-second-row">
      <input type="date" id="weight-date" />
      <input type="number" id="weight-value" placeholder="ä½“é‡ï¼ˆkgï¼‰" step="0.1" />
    </div>
    <div class="weight-row">
      <input type="text" id="weight-exercise"
             placeholder="ä»Šå¤©åšäº†ä»€ä¹ˆè¿åŠ¨ï¼Ÿä¾‹å¦‚ï¼šç‘œä¼½ 20 åˆ†é’Ÿ" />
      <button class="primary-btn small-btn" id="weight-add-btn">æ·»åŠ è®°å½•</button>
    </div>
    <div class="hint">ä½“é‡å’Œè¿åŠ¨è®°å½•ä»…ä¿å­˜åœ¨æœ¬æœºã€‚</div>

    <ul class="weight-list" id="weight-list"></ul>
  </div>

  <div class="card">
    <h2 class="section-title">æœ¬æœˆä½“é‡æŠ˜çº¿å›¾</h2>
    <div class="section-desc">
      æŒ‰æ—¥æœŸæŸ¥çœ‹æœ¬æœˆä½“é‡å˜åŒ–è¶‹åŠ¿ï¼ˆä»…å±•ç¤ºå½“å‰æœˆä»½æœ‰è®°å½•çš„æ—¥æœŸï¼‰ã€‚
    </div>
    <canvas id="weight-chart" height="200"></canvas>
  </div>
</section>

<!-- -------------------- ä½¿ç”¨è¯´æ˜ï¼ˆå¸¦åˆ·æ–°æŒ‰é’®ï¼‰ -------------------- -->
<section id="tab-about" class="tab-section">
  <div class="card">
    <div class="row-between">
      <h2 class="section-title">ä½¿ç”¨è¯´æ˜ & å°æ˜Ÿæ˜ŸæŒ‡å—</h2>
      <button class="small-btn primary-btn" id="force-reload-btn">
        åˆ·æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
      </button>
    </div>

    <!-- iOS å®‰è£…è¯´æ˜ -->
    <div class="about-section-title">ğŸ“± iOSï¼ˆiPhone / iPadï¼‰ï¼šæ·»åŠ åˆ°ä¸»å±å¹•</div>
    <ul class="about-list">
      <li>è¯·åŠ¡å¿…ä½¿ç”¨ <strong>Safari æµè§ˆå™¨</strong> æ‰“å¼€è¿™ä¸ªç½‘å€ã€‚</li>
      <li>é¡µé¢å®Œå…¨åŠ è½½åï¼Œç‚¹å‡»åº•éƒ¨ä¸­é—´çš„ <strong>ã€Œåˆ†äº«ã€æŒ‰é’®ï¼ˆä¸€ä¸ªæ–¹æ¡†å‘ä¸Šç®­å¤´ï¼‰</strong>ã€‚</li>
      <li>åœ¨å¼¹å‡ºçš„é€‰é¡¹ä¸­å‘ä¸‹æ»‘ï¼Œæ‰¾åˆ°å¹¶ç‚¹å‡» <strong>ã€Œæ·»åŠ åˆ°ä¸»å±å¹•ã€</strong>ã€‚</li>
      <li>å¦‚éœ€ï¼Œå¯ä»¥ä¿®æ”¹åç§°ï¼ˆä¾‹å¦‚ï¼š<em>My Project 50</em>ï¼‰ï¼Œç„¶åç‚¹å‡»å³ä¸Šè§’ <strong>ã€Œæ·»åŠ ã€</strong>ã€‚</li>
      <li>å›åˆ°ä¸»å±å¹•ï¼Œå°±èƒ½çœ‹åˆ°ä½ è‡ªå®šä¹‰çš„å°å›¾æ ‡ï¼Œå®ƒä¼šåƒç‹¬ç«‹ App ä¸€æ ·å…¨å±æ‰“å¼€ã€‚</li>
    </ul>

    <!-- Android å®‰è£…è¯´æ˜ -->
    <div class="about-section-title">ğŸ¤– Androidï¼ˆä»¥ Chrome ä¸ºä¾‹ï¼‰ï¼šæ·»åŠ åˆ°ä¸»å±å¹•</div>
    <ul class="about-list">
      <li>åœ¨ Android æ‰‹æœºä¸Šç”¨ <strong>Chrome</strong> æ‰“å¼€è¿™ä¸ªç½‘å€ã€‚</li>
      <li>é¡µé¢å³ä¸Šè§’ç‚¹å‡» <strong>ã€Œâ‹®ã€èœå•æŒ‰é’®</strong>ã€‚</li>
      <li>åœ¨èœå•ä¸­æ‰¾åˆ° <strong>ã€Œæ·»åŠ åˆ°ä¸»å±å¹•ã€</strong> æˆ– <strong>ã€Œå®‰è£…åº”ç”¨ã€</strong> å¹¶ç‚¹å‡»ã€‚</li>
      <li>ç¡®è®¤åç§°åç‚¹å‡»ã€Œæ·»åŠ ã€ï¼Œå›¾æ ‡å°±ä¼šå‡ºç°åœ¨ä¸»å±å¹•æˆ–åº”ç”¨åˆ—è¡¨ä¸­ã€‚</li>
    </ul>

    <!-- æ•°æ®è¯´æ˜ï¼ˆåªä¿ç•™ä½ éœ€è¦çš„éƒ¨åˆ†ï¼Œå»æ‰ä½ ä¸å–œæ¬¢çš„é‚£å‡ å¥ï¼‰ -->
    <div class="about-section-title">ğŸ” æ•°æ®ä¸éšç§</div>
    <ul class="about-list">
      <li>æ‰€æœ‰è®°å½•ï¼ˆProject 50 æ‰“å¡ã€å¾…åŠã€é‡è¦äº‹é¡¹ã€ä½“é‡ & è¿åŠ¨ï¼‰éƒ½ä¿å­˜åœ¨å½“å‰è®¾å¤‡çš„æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ï¼ˆlocalStorageï¼‰ã€‚</li>
      <li><strong>ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œä¹Ÿä¸ä¼šåœ¨ä¸åŒè®¾å¤‡ä¹‹é—´è‡ªåŠ¨åŒæ­¥ã€‚</strong></li>
      <li>å¦‚æœä½ åœ¨å¦ä¸€å°æ‰‹æœº / ç”µè„‘ä¸Šæ‰“å¼€åŒä¸€ä¸ªç½‘å€ï¼Œé‚£æ˜¯ä¸€ä»½å…¨æ–°çš„ã€Œç©ºç™½æœ¬å­ã€ï¼Œä¸ä¼šçœ‹åˆ°è¿™å°è®¾å¤‡çš„å†…å®¹ã€‚</li>
      <li>å¦‚æœéå¸¸åœ¨æ„é•¿æœŸå¤‡ä»½ï¼Œå»ºè®®å¶å°”æˆªå›¾æˆ–æŠŠå…³é”®æ•°æ®æ‰‹æŠ„ / å¤åˆ¶åˆ°è‡ªå·±çš„å¤‡å¿˜å½•é‡Œã€‚</li>
    </ul>

    <p class="hint">
      å¦‚æœå‘ç°é¡µé¢æ ·å¼é”™ä¹±æˆ–åŠŸèƒ½æ²¡æœ‰æ›´æ–°ï¼Œå¯ä»¥ç‚¹å‡»ä¸Šæ–¹ã€Œåˆ·æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€ï¼Œé‡æ–°åŠ è½½é¡µé¢ï¼ˆä¸ä¼šåˆ é™¤ä½ æœ¬æœºå·²ç»ä¿å­˜çš„æ•°æ®ï¼‰ã€‚
    </p>
  </div>
</section>


<script>
  /* å°å·¥å…·ï¼šæŠŠ "YYYY-MM-DD" è½¬æˆæœ¬åœ° 0 ç‚¹çš„ Dateï¼Œé¿å…è·¨æ—¶åŒºä¸²ä½ */
  function parseYmd(str) {
    if (!str) return new Date();
    return new Date(str + "T00:00:00");
  }

  /* ---------------- Tab åˆ‡æ¢ ---------------- */
  (function initTabs() {
    const tabButtons = document.querySelectorAll(".tab-btn");
    const sections = document.querySelectorAll(".tab-section");

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const targetId = btn.dataset.target;
        tabButtons.forEach((b) => b.classList.remove("active"));
        sections.forEach((sec) => sec.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(targetId).classList.add("active");
      });
    });
  })();

  /* ---------------- To-Do & ä¸“æ³¨ ---------------- */
  const TODO_STORAGE_KEY = "todo_tasks_v1";
  let todoTasks = []; // {id,title,category,date,focusMinutes,isDone,isRunning,startTimeMs}

  const todoTitleInput = document.getElementById("todo-title");
  const todoCategorySelect = document.getElementById("todo-category");
  const todoDateInput = document.getElementById("todo-date");
  const todoAddBtn = document.getElementById("todo-add-btn");
  const todoListEl = document.getElementById("todo-list");
  const todoEmptyEl = document.getElementById("todo-empty");

  const focusCalendarTitleEl = document.getElementById("focus-calendar-title");
  const focusCalendarGridEl = document.getElementById("focus-calendar-grid");
  const focusCalPrevBtn = document.getElementById("focus-cal-prev");
  const focusCalNextBtn = document.getElementById("focus-cal-next");
  let focusCalMonth;

  function loadTodos() {
    try {
      const raw = localStorage.getItem(TODO_STORAGE_KEY);
      if (raw) todoTasks = JSON.parse(raw) || [];
    } catch (e) {
      todoTasks = [];
    }
  }

  function saveTodos() {
    localStorage.setItem(TODO_STORAGE_KEY, JSON.stringify(todoTasks));
  }

  function addTodo() {
    const title = todoTitleInput.value.trim();
    if (!title) return;
    const category = todoCategorySelect.value;
    const dateStr = todoDateInput.value || getTodayStr();

    const task = {
      id: "t_" + Date.now() + "_" + Math.floor(Math.random() * 10000),
      title,
      category,
      date: dateStr,
      focusMinutes: 0,
      isDone: false,
      isRunning: false,
      startTimeMs: null,
    };
    todoTasks.push(task);
    saveTodos();
    todoTitleInput.value = "";
    renderTodoList();
    renderFocusCalendar();
    renderFocusPie();
  }

  function findTask(id) {
    return todoTasks.find((t) => t.id === id);
  }

  function toggleTodoDone(id) {
    const t = findTask(id);
    if (!t) return;
    t.isDone = !t.isDone;
    saveTodos();
    renderTodoList();
  }

  function deleteTodo(id) {
    todoTasks = todoTasks.filter((t) => t.id !== id);
    saveTodos();
    renderTodoList();
    renderFocusCalendar();
    renderFocusPie();
  }

  function toggleFocus(id) {
    const t = findTask(id);
    if (!t) return;

    if (!t.isRunning) {
      t.isRunning = true;
      t.startTimeMs = Date.now();
    } else {
      const now = Date.now();
      const diffMin = Math.round((now - t.startTimeMs) / 60000);
      if (diffMin > 0) t.focusMinutes += diffMin;
      t.isRunning = false;
      t.startTimeMs = null;
    }
    saveTodos();
    renderTodoList();
    renderFocusCalendar();
    renderFocusPie();
  }

  // ç¼–è¾‘å¾…åŠï¼šä¸æ¸…ç©ºä¸“æ³¨æ—¶é—´
  function editTodo(id) {
    const t = findTask(id);
    if (!t) return;

    const newTitle = prompt("ä¿®æ”¹å¾…åŠå†…å®¹ï¼š", t.title);
    if (newTitle === null) return;
    const trimmed = newTitle.trim();
    if (trimmed) t.title = trimmed;

    const newCat = prompt(
      "ä¿®æ”¹åˆ†ç±»ï¼ˆç›´æ¥å›è½¦ä¿æŒåŸåˆ†ç±»ï¼‰\nå¯é€‰ï¼šå­¦ä¹  / å·¥ä½œ / å®¶åº­ / ç”Ÿæ´» / å¨±ä¹ / å…¶ä»–",
      t.category
    );
    if (newCat !== null && newCat.trim()) {
      t.category = newCat.trim();
    }

    saveTodos();
    renderTodoList();
    renderFocusCalendar();
    renderFocusPie();
  }

  function renderTodoList() {
    const dateStr = todoDateInput.value || getTodayStr();
    todoDateInput.value = dateStr;

    const list = todoTasks.filter((t) => t.date === dateStr);
    todoListEl.innerHTML = "";

    if (list.length === 0) {
      todoEmptyEl.style.display = "block";
      return;
    }
    todoEmptyEl.style.display = "none";

    list.forEach((t) => {
      const li = document.createElement("li");
      li.className = "todo-item";

      const topRow = document.createElement("div");
      topRow.className = "todo-main-row";

      const main = document.createElement("div");
      main.className = "todo-main";

      const title = document.createElement("div");
      title.className = "todo-title" + (t.isDone ? " done" : "");
      title.textContent = t.title;

      const meta = document.createElement("div");
      const catSpan = document.createElement("span");
      catSpan.className = "badge-category";
      catSpan.textContent = t.category;
      const timeSpan = document.createElement("span");
      timeSpan.className = "todo-meta-text";
      timeSpan.textContent = "ä¸“æ³¨ " + (t.focusMinutes || 0) + " åˆ†é’Ÿ";

      meta.appendChild(catSpan);
      meta.appendChild(timeSpan);

      main.appendChild(title);
      main.appendChild(meta);

      const doneRow = document.createElement("div");
      doneRow.className = "done-row";
      const doneCheck = document.createElement("input");
      doneCheck.type = "checkbox";
      doneCheck.checked = t.isDone;
      doneCheck.addEventListener("change", () => toggleTodoDone(t.id));
      const doneLabel = document.createElement("span");
      doneLabel.textContent = "å®Œæˆ";
      doneRow.appendChild(doneCheck);
      doneRow.appendChild(doneLabel);

      topRow.appendChild(main);
      topRow.appendChild(doneRow);

      const actions = document.createElement("div");
      actions.className = "todo-actions-row";

      const editBtn = document.createElement("button");
      editBtn.className = "small-btn edit-btn";
      editBtn.textContent = "ç¼–è¾‘";
      editBtn.addEventListener("click", () => editTodo(t.id));

      const focusBtn = document.createElement("button");
      focusBtn.className =
        "small-btn focus-btn" + (t.isRunning ? " stop" : "");
      focusBtn.textContent = t.isRunning ? "ç»“æŸä¸“æ³¨" : "å¼€å§‹ä¸“æ³¨";
      focusBtn.addEventListener("click", () => toggleFocus(t.id));

      const delBtn = document.createElement("button");
      delBtn.className = "small-btn delete-btn";
      delBtn.textContent = "åˆ é™¤";
      delBtn.addEventListener("click", () => deleteTodo(t.id));

      actions.appendChild(editBtn);
      actions.appendChild(focusBtn);
      actions.appendChild(delBtn);

      li.appendChild(topRow);
      li.appendChild(actions);
      todoListEl.appendChild(li);
    });
  }

  // ä¸“æ³¨ç±»åˆ«æ—¥å†
  function renderFocusCalendar() {
    const base = focusCalMonth || new Date();
    const year = base.getFullYear();
    const month = base.getMonth();
    focusCalendarTitleEl.textContent =
      "ä¸“æ³¨ç±»åˆ«æ—¥å† Â· " + year + " å¹´ " + (month + 1) + " æœˆ";

    const map = {}; // day -> Set(categories)
    todoTasks.forEach((t) => {
      if (!t.date || !t.focusMinutes) return;
      const d = parseYmd(t.date);
      if (d.getFullYear() === year && d.getMonth() === month) {
        const day = d.getDate();
        if (!map[day]) map[day] = new Set();
        map[day].add(t.category);
      }
    });

    const firstDay = new Date(year, month, 1);
    const firstWeekday = firstDay.getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    focusCalendarGridEl.innerHTML = "";

    const weekdays = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];
    weekdays.forEach((w) => {
      const cell = document.createElement("div");
      cell.className = "cal-cell cal-weekday";
      cell.textContent = w;
      focusCalendarGridEl.appendChild(cell);
    });

    for (let i = 0; i < firstWeekday; i++) {
      const empty = document.createElement("div");
      empty.className = "cal-cell cal-empty";
      focusCalendarGridEl.appendChild(empty);
    }

    const categoryColors = {
      å­¦ä¹ : "#6366f1",
      å·¥ä½œ: "#22c55e",
      å®¶åº­: "#f97316",
      ç”Ÿæ´»: "#0ea5e9",
      å¨±ä¹: "#ec4899",
      å…¶ä»–: "#6b7280",
    };

    for (let day = 1; day <= daysInMonth; day++) {
      const cell = document.createElement("div");
      cell.className = "cal-cell cal-level-0";

      const num = document.createElement("div");
      num.className = "cal-day-num";
      num.textContent = day;
      cell.appendChild(num);

      const cats = map[day];
      if (cats && cats.size > 0) {
        const bar = document.createElement("div");
        bar.style.display = "flex";
        bar.style.marginTop = "2px";
        bar.style.width = "100%";
        bar.style.height = "6px";

        cats.forEach((cat) => {
          const seg = document.createElement("div");
          seg.style.flex = "1";
          seg.style.borderRadius = "999px";
          seg.style.margin = "0 1px";
          seg.style.background = categoryColors[cat] || "#9ca3af";
          bar.appendChild(seg);
        });

        cell.appendChild(bar);
      }

      // ç‚¹å‡»æŸå¤© -> åˆ‡æ¢ä¸Šæ–¹åˆ—è¡¨æ—¥æœŸ
      cell.addEventListener("click", () => {
        const ds =
          year +
          "-" +
          String(month + 1).padStart(2, "0") +
          "-" +
          String(day).padStart(2, "0");
        todoDateInput.value = ds;
        renderTodoList();
      });

      focusCalendarGridEl.appendChild(cell);
    }
  }

  focusCalPrevBtn.addEventListener("click", () => {
    focusCalMonth = shiftMonth(focusCalMonth, -1);
    renderFocusCalendar();
  });
  focusCalNextBtn.addEventListener("click", () => {
    focusCalMonth = shiftMonth(focusCalMonth, 1);
    renderFocusCalendar();
  });

  todoAddBtn.addEventListener("click", addTodo);
  todoTitleInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") addTodo();
  });
  todoDateInput.addEventListener("change", renderTodoList);

  /* ---------------- ä¸“æ³¨é¥¼å›¾ ---------------- */
  const pieCanvas = document.getElementById("focus-pie");
  const pieCtx = pieCanvas.getContext("2d");
  const pieLabel = document.getElementById("pie-label");
  const pieLegendEl = document.getElementById("pie-legend");
  const pieWeekBtn = document.getElementById("pie-week-btn");
  const pieMonthBtn = document.getElementById("pie-month-btn");
  const pieYearBtn = document.getElementById("pie-year-btn");
  let pieMode = "week";

  function computePieData(mode) {
    const now = new Date();
    const totals = {};
    todoTasks.forEach((t) => {
      if (!t.focusMinutes || !t.date) return;
      const d = parseYmd(t.date);

      if (mode === "week") {
        const diff = (now - d) / (1000 * 60 * 60 * 24);
        if (diff < 0 || diff > 7) return;
      } else if (mode === "month") {
        if (
          d.getFullYear() !== now.getFullYear() ||
          d.getMonth() !== now.getMonth()
        )
          return;
      } else if (mode === "year") {
        if (d.getFullYear() !== now.getFullYear()) return;
      }

      totals[t.category] = (totals[t.category] || 0) + t.focusMinutes;
    });
    return totals;
  }

  function renderFocusPie() {
    const totals = computePieData(pieMode);
    const cats = Object.keys(totals);
    const sum = cats.reduce((s, c) => s + totals[c], 0);

    pieCtx.clearRect(0, 0, pieCanvas.width, pieCanvas.height);
    if (pieLegendEl) pieLegendEl.innerHTML = "";

    if (!sum) return;

    let start = -Math.PI / 2;
    const colors = {
      å­¦ä¹ : "#6366f1",
      å·¥ä½œ: "#22c55e",
      å®¶åº­: "#f97316",
      ç”Ÿæ´»: "#0ea5e9",
      å¨±ä¹: "#ec4899",
      å…¶ä»–: "#6b7280",
    };

    cats.forEach((cat) => {
      const value = totals[cat];
      const angle = (value / sum) * Math.PI * 2;
      pieCtx.beginPath();
      pieCtx.moveTo(pieCanvas.width / 2, pieCanvas.height / 2);
      pieCtx.arc(
        pieCanvas.width / 2,
        pieCanvas.height / 2,
        Math.min(pieCanvas.width, pieCanvas.height) / 2 - 4,
        start,
        start + angle
      );
      pieCtx.closePath();
      pieCtx.fillStyle = colors[cat] || "#9ca3af";
      pieCtx.fill();
      start += angle;
    });

    if (pieLegendEl) {
      cats.forEach((cat) => {
        const item = document.createElement("div");
        item.className = "pie-legend-item";

        const colorBox = document.createElement("span");
        colorBox.className = "pie-legend-color";
        colorBox.style.background = colors[cat] || "#9ca3af";

        const label = document.createElement("span");
        label.textContent = cat + "ï¼ˆ" + totals[cat] + " åˆ†é’Ÿï¼‰";

        item.appendChild(colorBox);
        item.appendChild(label);
        pieLegendEl.appendChild(item);
      });
    }
  }

  pieWeekBtn.addEventListener("click", () => {
    pieMode = "week";
    pieLabel.textContent = "æœ€è¿‘ä¸€å‘¨";
    renderFocusPie();
  });
  pieMonthBtn.addEventListener("click", () => {
    pieMode = "month";
    pieLabel.textContent = "æœ¬æœˆ";
    renderFocusPie();
  });
  pieYearBtn.addEventListener("click", () => {
    pieMode = "year";
    pieLabel.textContent = "æœ¬å¹´";
    renderFocusPie();
  });

  /* ---------------- æ¯æ—¥é‡è¦äº‹é¡¹ ---------------- */
  const IMPORTANT_STORAGE_KEY = "important_events_v1";
  let importantEvents = []; // {id,date,type,title,note}

  const importantDateInput = document.getElementById("important-date");
  const importantTypeSelect = document.getElementById("important-type");
  const importantTitleInput = document.getElementById("important-title");
  const importantNoteInput = document.getElementById("important-note");
  const importantAddBtn = document.getElementById("important-add-btn");
  const importantListEl = document.getElementById("important-list");
  const importantCalTitleEl = document.getElementById("important-calendar-title");
  const importantCalGridEl = document.getElementById("important-calendar-grid");
  const importantCalPrevBtn = document.getElementById("important-cal-prev");
  const importantCalNextBtn = document.getElementById("important-cal-next");
  let importantCalMonth;

  function loadImportant() {
    try {
      const raw = localStorage.getItem(IMPORTANT_STORAGE_KEY);
      if (raw) importantEvents = JSON.parse(raw) || [];
    } catch (e) {
      importantEvents = [];
    }
  }

  function saveImportant() {
    localStorage.setItem(IMPORTANT_STORAGE_KEY, JSON.stringify(importantEvents));
  }

  function addImportant() {
    const dateStr = importantDateInput.value || getTodayStr();
    const type = importantTypeSelect.value;
    const title = importantTitleInput.value.trim();
    const note = importantNoteInput.value.trim();
    if (!title) return;

    const ev = {
      id: "imp_" + Date.now() + "_" + Math.floor(Math.random() * 10000),
      date: dateStr,
      type,
      title,
      note,
    };
    importantEvents.push(ev);
    saveImportant();
    importantTitleInput.value = "";
    importantNoteInput.value = "";
    renderImportantList(dateStr);
    renderImportantCalendar();
  }

  function renderImportantList(selectedDate) {
    const targetDate = selectedDate || importantDateInput.value || getTodayStr();
    importantDateInput.value = targetDate;
    importantListEl.innerHTML = "";

    const list = importantEvents.filter((e) => e.date === targetDate);
    if (list.length === 0) {
      const li = document.createElement("li");
      li.className = "important-item";
      li.textContent = "è¿™ä¸€å¤©è¿˜æ²¡æœ‰é‡è¦äº‹é¡¹ï½";
      importantListEl.appendChild(li);
      return;
    }

    list.forEach((e) => {
      const li = document.createElement("li");
      li.className = "important-item";

      const topRow = document.createElement("div");
      topRow.className = "important-top-row";

      const titleSpan = document.createElement("span");
      titleSpan.className = "important-title";
      titleSpan.textContent = e.title;

      const typeSpan = document.createElement("span");
      typeSpan.className = "important-type-badge imp-type-" + e.type;
      typeSpan.textContent = e.type;

      topRow.appendChild(titleSpan);
      topRow.appendChild(typeSpan);

      const noteDiv = document.createElement("div");
      noteDiv.className = "important-note";
      noteDiv.textContent = e.note || "";

      const dateDiv = document.createElement("div");
      dateDiv.className = "important-date";
      dateDiv.textContent = "æ—¥æœŸï¼š" + e.date;

      li.appendChild(topRow);
      li.appendChild(noteDiv);
      li.appendChild(dateDiv);
      importantListEl.appendChild(li);
    });
  }

    function renderImportantCalendar() {
    const base = importantCalMonth || new Date();
    const year = base.getFullYear();
    const month = base.getMonth();

    importantCalTitleEl.textContent =
      "é‡è¦äº‹é¡¹æ—¥å† Â· " + year + " å¹´ " + (month + 1) + " æœˆ";

    // day -> å½“å¤©çš„äº‹ä»¶åˆ—è¡¨
    const map = {}; 
    importantEvents.forEach((e) => {
      if (!e.date) return;
      const d = parseYmd(e.date);
      if (d.getFullYear() === year && d.getMonth() === month) {
        const day = d.getDate();
        if (!map[day]) map[day] = [];
        map[day].push(e);
      }
    });

    importantCalGridEl.innerHTML = "";

    const weekdays = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];
    weekdays.forEach((w) => {
      const cell = document.createElement("div");
      cell.className = "cal-cell cal-weekday";
      cell.textContent = w;
      importantCalGridEl.appendChild(cell);
    });

    const firstDay = new Date(year, month, 1);
    const firstWeekday = firstDay.getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    for (let i = 0; i < firstWeekday; i++) {
      const empty = document.createElement("div");
      empty.className = "cal-cell cal-empty";
      importantCalGridEl.appendChild(empty);
    }

    const typeColors = {
      ç”Ÿæ´»é‡è¦äº‹é¡¹: "#f97373",
      å§¨å¦ˆæœŸ: "#ec4899",
      å›ºå®šèµ„é‡‘äº¤ä»˜æ—¥: "#8b5cf6",
      ç”Ÿæ—¥: "#facc15",
      çºªå¿µæ—¥: "#14b8a6",
      å·¥ä½œé‡è¦äº‹é¡¹: "#3b82f6",
      å­¦ä¸šé‡è¦äº‹é¡¹: "#a855f7",
    };

    for (let day = 1; day <= daysInMonth; day++) {
      const cell = document.createElement("div");
      cell.className = "cal-cell cal-level-0";

      const num = document.createElement("div");
      num.className = "cal-day-num";
      num.textContent = day;
      cell.appendChild(num);

      const events = map[day];
      if (events && events.length > 0) {
        // 1ï¼‰ä¿ç•™åŸæ¥çš„è‰²æ¡ï¼šä½“ç°æœ‰å“ªäº›ç±»å‹
        const bar = document.createElement("div");
        bar.style.display = "flex";
        bar.style.marginTop = "2px";
        bar.style.width = "100%";
        bar.style.height = "6px";

        const uniqTypes = Array.from(new Set(events.map(e => e.type)));
        uniqTypes.forEach((type) => {
          const seg = document.createElement("div");
          seg.style.flex = "1";
          seg.style.borderRadius = "999px";
          seg.style.margin = "0 1px";
          seg.style.background = typeColors[type] || "#9ca3af";
          bar.appendChild(seg);
        });
        cell.appendChild(bar);

        // 2ï¼‰æ˜¾ç¤ºæ ‡é¢˜ï¼šå–æ‰€æœ‰äº‹ä»¶æ ‡é¢˜ï¼Œåšä¸€ä¸ªç®€çŸ­æ±‡æ€»
        const titles = events.map(e => e.title).filter(Boolean);
        if (titles.length > 0) {
          let text = titles.join(" / ");
          if (text.length > 14) {
            text = text.slice(0, 14) + "â€¦";
          }
          const textDiv = document.createElement("div");
          textDiv.className = "important-event-text";
          textDiv.textContent = text;
          cell.appendChild(textDiv);
        }
      }

      // ç‚¹å‡»æŸå¤©ï¼šä¸Šé¢çš„åˆ—è¡¨æ˜¾ç¤ºè¿™ä¸€å¤©çš„æ‰€æœ‰è¯¦æƒ…
      cell.addEventListener("click", () => {
        const ds =
          year +
          "-" +
          String(month + 1).padStart(2, "0") +
          "-" +
          String(day).padStart(2, "0");
        renderImportantList(ds);
      });

      importantCalGridEl.appendChild(cell);
    }
  }


  importantAddBtn.addEventListener("click", addImportant);
  importantDateInput.addEventListener("change", () => {
    renderImportantList(importantDateInput.value || getTodayStr());
  });
  importantCalPrevBtn.addEventListener("click", () => {
    importantCalMonth = shiftMonth(importantCalMonth, -1);
    renderImportantCalendar();
  });
  importantCalNextBtn.addEventListener("click", () => {
    importantCalMonth = shiftMonth(importantCalMonth, 1);
    renderImportantCalendar();
  });

  /* ---------------- ä½“é‡ & è¿åŠ¨ ---------------- */
  const WEIGHT_STORAGE_KEY = "weight_logs_v1";
  let weightLogs = []; // {id,date,weight,exercise}

  const weightDateInput = document.getElementById("weight-date");
  const weightValueInput = document.getElementById("weight-value");
  const weightExerciseInput = document.getElementById("weight-exercise");
  const weightAddBtn = document.getElementById("weight-add-btn");
  const weightListEl = document.getElementById("weight-list");
  const weightChartCanvas = document.getElementById("weight-chart");
  const weightCtx = weightChartCanvas.getContext("2d");

  function loadWeight() {
    try {
      const raw = localStorage.getItem(WEIGHT_STORAGE_KEY);
      if (raw) weightLogs = JSON.parse(raw) || [];
    } catch (e) {
      weightLogs = [];
    }
  }

  function saveWeight() {
    localStorage.setItem(WEIGHT_STORAGE_KEY, JSON.stringify(weightLogs));
  }

  function addWeight() {
    const dateStr = weightDateInput.value || getTodayStr();
    const weight = parseFloat(weightValueInput.value);
    const exercise = weightExerciseInput.value.trim();
    if (isNaN(weight)) return;

    const log = {
      id: "w_" + Date.now() + "_" + Math.floor(Math.random() * 10000),
      date: dateStr,
      weight,
      exercise,
    };
    weightLogs.push(log);
    saveWeight();
    weightValueInput.value = "";
    weightExerciseInput.value = "";
    renderWeightList();
    renderWeightChart();
  }

  function renderWeightList() {
    const list = [...weightLogs].sort((a, b) => a.date.localeCompare(b.date));
    weightListEl.innerHTML = "";

    if (list.length === 0) {
      const li = document.createElement("li");
      li.className = "weight-item";
      li.textContent = "ç›®å‰è¿˜æ²¡æœ‰ä½“é‡è®°å½•ã€‚";
      weightListEl.appendChild(li);
      return;
    }

    list.forEach((w) => {
      const li = document.createElement("li");
      li.className = "weight-item";
      li.textContent = w.date + " Â· " + w.weight.toFixed(1) + " kg";
      const meta = document.createElement("div");
      meta.className = "weight-meta";
      meta.textContent = w.exercise || "æ— ç‰¹åˆ«å¤‡æ³¨";
      li.appendChild(meta);
      weightListEl.appendChild(li);
    });
  }

  function renderWeightChart() {
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth();

    const monthLogs = weightLogs
      .filter((w) => {
        const d = parseYmd(w.date);
        return d.getFullYear() === year && d.getMonth() === month;
      })
      .sort((a, b) => a.date.localeCompare(b.date));

    weightCtx.clearRect(0, 0, weightChartCanvas.width, weightChartCanvas.height);
    if (monthLogs.length === 0) return;

    const padding = 20;
    const w = weightChartCanvas.width;
    const h = weightChartCanvas.height;

    const minWeight = Math.min(...monthLogs.map((x) => x.weight));
    const maxWeight = Math.max(...monthLogs.map((x) => x.weight));
    const range = maxWeight - minWeight || 1;
    const stepX = (w - padding * 2) / Math.max(monthLogs.length - 1, 1);

    // åæ ‡è½´
    weightCtx.strokeStyle = "#9ca3af";
    weightCtx.lineWidth = 1;
    weightCtx.beginPath();
    weightCtx.moveTo(padding, padding);
    weightCtx.lineTo(padding, h - padding);
    weightCtx.lineTo(w - padding, h - padding);
    weightCtx.stroke();

    // æŠ˜çº¿
    weightCtx.strokeStyle = "#ec4899";
    weightCtx.lineWidth = 2;
    weightCtx.beginPath();

    monthLogs.forEach((log, idx) => {
      const x = padding + stepX * idx;
      const y =
        h -
        padding -
        ((log.weight - minWeight) / range) * (h - padding * 2);

      if (idx === 0) weightCtx.moveTo(x, y);
      else weightCtx.lineTo(x, y);

      weightCtx.fillStyle = "#ec4899";
      weightCtx.beginPath();
      weightCtx.arc(x, y, 3, 0, Math.PI * 2);
      weightCtx.fill();
    });
  }

  weightAddBtn.addEventListener("click", addWeight);

  /* ---------------- ä½¿ç”¨è¯´æ˜ï¼šåˆ·æ–°æŒ‰é’® ---------------- */
  const reloadBtn = document.getElementById("force-reload-btn");
  if (reloadBtn) {
    reloadBtn.addEventListener("click", () => {
      window.location.reload();
    });
  }

  /* ---------------- è¦†ç›– Project50 æ—¥å†ï¼ˆä¿®æ­£æ—¶åŒºï¼‰ ---------------- */
  // è¿™é‡Œé‡å†™ renderP50Calendarï¼Œä½¿ç”¨ parseYmdï¼Œé¿å…æ—¥æœŸåç§»
  function renderP50Calendar() {
    const base = window.p50CalMonth || new Date();
    const year = base.getFullYear();
    const month = base.getMonth();

    const titleEl = document.getElementById("p50-calendar-title");
    const gridEl = document.getElementById("p50-calendar-grid");
    if (!titleEl || !gridEl) return;

    titleEl.textContent =
      "Project 50 æ—¥å† Â· " + year + " å¹´ " + (month + 1) + " æœˆ";

    const countByDay = {};
    if (window.p50Data && window.P50_RULES) {
      Object.keys(p50Data).forEach((dateStr) => {
        const d = parseYmd(dateStr);
        if (d.getFullYear() === year && d.getMonth() === month) {
          const day = d.getDate();
          const rules = (p50Data[dateStr] && p50Data[dateStr].rules) || {};
          let c = 0;
          P50_RULES.forEach((r) => {
            if (rules[r.id]) c++;
          });
          countByDay[day] = c;
        }
      });
    }

    const firstDay = new Date(year, month, 1);
    const firstWeekday = firstDay.getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    gridEl.innerHTML = "";

    const weekdays = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];
    weekdays.forEach((w) => {
      const cell = document.createElement("div");
      cell.className = "cal-cell cal-weekday";
      cell.textContent = w;
      gridEl.appendChild(cell);
    });

    for (let i = 0; i < firstWeekday; i++) {
      const empty = document.createElement("div");
      empty.className = "cal-cell cal-empty";
      gridEl.appendChild(empty);
    }

    for (let day = 1; day <= daysInMonth; day++) {
      const cell = document.createElement("div");
      const count = countByDay[day] || 0;
      let levelClass = "cal-level-0";
      if (count >= 7) levelClass = "cal-level-4";
      else if (count >= 5) levelClass = "cal-level-3";
      else if (count >= 3) levelClass = "cal-level-2";
      else if (count >= 1) levelClass = "cal-level-1";

      cell.className = "cal-cell " + levelClass;

      const num = document.createElement("div");
      num.className = "cal-day-num";
      num.textContent = day;

      cell.appendChild(num);
      gridEl.appendChild(cell);
    }
  }

  /* ---------------- åˆå§‹åŒ– ---------------- */
  function initApp() {
    const today = getTodayStr();

    const p50DateInput = document.getElementById("p50-date");
    if (p50DateInput) p50DateInput.value = today;
    if (todoDateInput) todoDateInput.value = today;
    if (importantDateInput) importantDateInput.value = today;
    if (weightDateInput) weightDateInput.value = today;

    // åˆå§‹åŒ–å„æ¨¡å—æœˆä»½
    window.p50CalMonth = new Date();
    window.p50CalMonth.setDate(1);

    focusCalMonth = new Date();
    focusCalMonth.setDate(1);

    importantCalMonth = new Date();
    importantCalMonth.setDate(1);

    // P50 çš„ load / render åœ¨å‰ä¸€ä¸ª <script> é‡Œå·²ç»å®šä¹‰
    if (typeof loadP50Data === "function") {
      loadP50Data();
    }

    loadTodos();
    loadImportant();
    loadWeight();

    if (typeof renderP50Day === "function") {
      renderP50Day();
    }
    renderP50Calendar();
    renderTodoList();
    renderFocusCalendar();
    renderFocusPie();
    renderImportantList();
    renderImportantCalendar();
    renderWeightList();
    renderWeightChart();
  }

  // å› ä¸º <script> åœ¨é¡µé¢åº•éƒ¨ï¼ŒDOM å·²ç»åŠ è½½å®Œæ¯•ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨
  initApp();
</script>
</div> <!-- .app -->
</body>
</html>